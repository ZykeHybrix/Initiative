<html>
<div id="addCharacterFormDiv">
	<input id="characterName" name="name" type="text" placeholder="character name"/>
	<input id="characterInitiative" name="initiative" type="number" placeholder="initiative number"/>
	<select id="characterType" name="type">
		<option value="player">Player</option>
		<option value="enemy">Enemy</option>
	</select>
	<button id="characterButton" onclick="addCharacter();">Add Character</button>
</div>
<div>
	<button id="combatButton" onclick="toggleCombat();">Start Combat</button>
	<button id="turnButton" onclick="advanceTurn();" style="display: none;">Advance Turn</button>
</div>
<div id="playerDiv"></div>
<div style="clear: left;"><br /></div>
<div id="enemyDiv"></div>
<div style="clear: left;"><br /></div>
<div id="combatDiv"><div>
</html>
<script>
var playerList = [{name: 'me', initiative: 19}, {name: 'myself', initiative: 18}, {name: 'i', initiative: 21}];
var enemyList = [{name: 'pirate', initiative: 17}, {name: 'skeleton', initiative: 23}, {name: 'ogre', initiative: 10}];
var combatList = [...playerList, ...enemyList];
var combatToggle = 0;
var currentTurn = 0;

var playerDiv = document.getElementById("playerDiv");
var enemyDiv = document.getElementById("enemyDiv");
var combatDiv = document.getElementById("combatDiv");
var combatButton = document.getElementById("combatButton");
var turnButton = document.getElementById("turnButton");


function displayLists() {
	var playerContents = '';
	this.playerList.forEach(function(object){
		playerContents += "<div style='border-style: solid; height: 150px; width: 300px; float: left;'>";
		playerContents += object.name + ' - ' + object.initiative;
		playerContents += '<button onclick="removeCharacterFromList(' + "'player', '" + object.name + "'" + ');">X</button>';		
		playerContents += "</div>";
	});
	
	this.playerDiv.innerHTML = playerContents;

	var enemyContents = '';
	this.enemyList.forEach(function(object){
		enemyContents += "<div style='border-style: solid; height: 150px; width: 300px; float: left;'>";
		enemyContents += object.name + ' - ' + object.initiative;
		enemyContents += '<button onclick="removeCharacterFromList(' + "'enemy', '" + object.name + "'" + ');">X</button>';		
		enemyContents += "</div>";
	});
	
	this.enemyDiv.innerHTML = enemyContents;
};	

function displayCombatList() {
	var combatContents = '';
	this.combatList.sort((a, b) => (a.initiative < b.initiative) ? 1 : -1);

	this.combatList.forEach(function(object, index){
		combatContents += "<div style='border-style: solid; height: 150px; width: 300px;'>";
		combatContents += object.name + ' - ' + object.initiative;
		combatContents += '<button onclick="removeCharacterFromList(' + "'combat', '" + object.name + "'" + ');">X</button>';
		if (index == this.currentTurn) {
			combatContents += "<- Current Turn";
		}
		combatContents += "</div>";
	});
	
	this.combatDiv.innerHTML = combatContents;
	
	if (this.combatToggle == 0) {
		this.combatDiv.style.display = 'none';
	}
	if (this.combatToggle == 1) {
		this.combatDiv.style.display = '';
	}
};

function addCharacter() {
	var characterNameInput = document.getElementById("characterName");
	var characterNameValue = characterNameInput.value;
	var characterInitiativeInput = document.getElementById("characterInitiative");
	var characterInitiativeValue = characterInitiativeInput.value;
	var characterTypeInput = document.getElementById("characterType");
	var characterTypeValue = characterTypeInput.value;
	var newObject = {};
	newObject.name = characterNameValue;
	newObject.initiative = characterInitiativeValue;

	if (characterTypeValue == 'player') {
		this.playerList.push(newObject);
	}
	if (characterTypeValue == 'enemy') {
		this.enemyList.push(newObject);
	}
	
	
	this.combatList = [...this.playerList, ...this.enemyList];
	displayLists();
};

function toggleCombat() {
	this.combatList = [...playerList, ...enemyList];
	
	if (this.combatToggle == 0) {
		this.combatToggle = 1;
		this.turnButton.style.display = '';
		this.combatButton.innerHTML = "Stop Combat";
		this.playerDiv.style.display = 'none';
		this.enemyDiv.style.display = 'none';
	} else if (this.combatToggle == 1) {
		this.combatToggle = 0;
		this.currentTurn = 0;
		this.turnButton.style.display = 'none';
		this.combatButton.innerHTML = "Start Combat";
		this.playerDiv.style.display = '';
		this.enemyDiv.style.display = '';
	}
	displayCombatList();
};

function advanceTurn() {
	if (this.combatList.length == this.currentTurn + 1) {
		this.currentTurn = 0;
	} else {
		this.currentTurn++;
	}
	
	displayCombatList();
};

function removeCharacterFromList(listName, name) {
	var objectToRemove = {};
	this.combatList.forEach(function(object){
		if (object.name == name) {
			objectToRemove = object;
		}

	});

	if (listName == 'combat') {
		var idx = this.combatList.indexOf(objectToRemove);
		if (idx !== -1) {
			this.combatList.splice(idx, 1);
		}
		if(combatList.length < 1 || combatList == undefined){
			toggleCombat();
		}
		displayCombatList();
	}
	if (listName == 'player') {
		var idx = this.playerList.indexOf(objectToRemove);
		if (idx !== -1) {
			this.playerList.splice(idx, 1);
		}
		this.combatList = [...playerList, ...enemyList];
		displayLists();
	}
	if (listName == 'enemy') {
		var idx = this.enemyList.indexOf(objectToRemove);
		if (idx !== -1) {
			this.enemyList.splice(idx, 1);
		}
		this.combatList = [...playerList, ...enemyList];
		displayLists();
	}

	//var characterTypeValue = type;

	//if (characterTypeValue == 'player') {
		//this.playerList.filter(function(el) { return el.name != name;}); 
	//}
	//if (characterTypeValue == 'enemy') {
		//this.enemyList.filter(function(el) { return (el.name != name && el.initiative != object.initiative );}); 
	//}

	displayLists();
	
};

displayLists();
</script>
